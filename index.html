<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <title>FS CRM</title>
    <style>
        .addcust svg {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            cursor: pointer;
            z-index: 9999;
            border-radius: 50%;
            background: #c53f3f;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: pulse 1.5s infinite;
            transition: transform 0.2s ease-in-out;
        }

        .addcust svg path {
            stroke: #fff !important;
        }

        .addcust svg:hover {
            transform: scale(1.15);
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(197, 63, 63, 0.4);
            }

            70% {
                transform: scale(1.1);
                box-shadow: 0 0 0 20px rgba(197, 63, 63, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(197, 63, 63, 0);
            }
        }

        #headerx .header,
        #headerx .search-bar {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        #headerx svg {
            stroke: #c53f3f;
        }

        .header-title img {
            height: 30px;
        }

        .header-icons {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #headerx .search-bar {
            display: none;
            align-items: center;
            width: 100%;
            position: relative;
            padding: 3px 0;
        }

        .search-input-wrapper {
            position: relative;
            width: 100%;
            display: flex;
            margin: 0 8px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .search-input-wrapper input {
            width: 100%;
            padding: 8px 35px 5px 40px;
            border: none;
            outline: none;
            background: none;
            color: #c53f3f;
            text-transform: capitalize;
        }

        .search-input-wrapper input::placeholder {
            color: #c53f3f;
            opacity: 0.7;
        }

        .search-input-wrapper .search-icon {
            position: absolute;
            top: 5px;
            left: 8px;
        }

        .dropdown-menu-custom {
            position: absolute;
            top: 40px;
            right: 0px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            display: none;
            min-width: 150px;
            z-index: +3;
            overflow: hidden;
        }

        .dropdown-menu-custom a {
            display: block;
            padding: 10px;
            color: black;
            text-decoration: none;
        }

        .dropdown-menu-custom a:hover {
            background-color: #f1f1f1;
        }

        .my-ride-details .icon {
            height: 30px;
            width: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(var(--box-bg), 1);
            --Iconsax-Color: rgba(var(--title-color), 1);
            --Iconsax-Size: 16px;
            border-radius: 100%;
        }

        .my-ride-details .icon.error-icon {
            background-color: rgba(var(--error-color), 0.1);
            --Iconsax-Color: rgba(var(--error-color), 1);
            --Iconsax-Size: 16px;
        }

        #absenkeluar>div:first-child {
            background: #c53f3f;
            padding: 40px 20px 60px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .seclist {
            background: #fff;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
            overflow: hidden;
            margin-top: -20px;
            z-index: +1;
            position: absolute;
            border: none;
            width: 100%;
            min-height: calc(100vh - 240px);
        }

        #absenkeluar>div:first-child:before {
            content: " ";
            width: calc(100% + 15rem);
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
            background-image: url(./assets/images/bgbca.svg);
            background-position: -10rem -14rem;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .bg-pattern .card::before {
            background: linear-gradient(135deg, #f8f9fa 25%, #e8f5e9 100%);
            background-image: url(./assets/images/bg2.svg);
            background-size: cover;
            border: none;
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .card-absen {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }

        .clock-time {
            font-size: 2.5rem;
            font-weight: bold;
            color: #212529;
            margin: 0;
            line-height: 1;
        }

        .btn-clock {
            padding: 10px 25px;
            font-size: 1rem;
            border-radius: 10px;
            width: 100%;
        }

        .status-dot {
            height: 10px;
            width: 10px;
            background-color: #28a745;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .user-info h5 {
            margin: 0;
            font-weight: 600;
        }

        .location {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .left-box {
            border-right: 1px solid #dee2e6;
            padding-right: 15px;
        }

        @media (max-width: 576px) {
            .left-box {
                padding-bottom: 0;
            }
        }
    </style>
</head>

<body>
    <header id="header" class="main-header"
        style="background:#fff;padding:10px 0;box-shadow: 3px -2px 10px rgb(0 0 0 / 47%);">
        <div class="custom-container">
            <div id="headerx"></div>
        </div>
    </header>

    <div id="absenkeluar"></div>

    <section class="seclist">
        <div class="custom-container">
            <ul class="my-ride-list" style="margin-top: 0;"></ul>
        </div>
    </section>

    <section class="panel-space"></section>

    <a href="./listpelanggan.html" class="iconsax addcust" data-icon="add" id="addform">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 12H18" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M12 18V6" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
    </a>

    <script src="./assets/js/script.js"></script>
    <script>
        let panelkeluar = () => {
            let createDashboardUI = () => {
                let bgPatternDiv = document.createElement('div');
                bgPatternDiv.className = 'bg-pattern';

                let cardAbsen = document.createElement('div');
                cardAbsen.className = 'card card-absen p-3 position-relative';

                let row = document.createElement('div');
                row.className = 'row align-items-center position-relative';

                let leftCol = document.createElement('div');
                leftCol.className = 'col-6 text-center left-box';
                let leftColHtml = `
                    <p class="mb-1 text-secondary" id="currentDate"></p>
                    <p class="clock-time" id="currentTime"></p>
                `;
                leftCol.innerHTML = leftColHtml;

                let data = localStorage.getItem('user_absen'),
                    obj = data ? JSON.parse(data) : null,
                    jam = obj && obj.jam ? String(obj.jam) : '';


                let rightCol = document.createElement('div');
                rightCol.className = 'col-6 text-center';
                let rightColHtml = `
                    <p class="mb-2">
                        <span class="status-dot"></span>
                        <span id="clockInTime">Check In : ${jam} WIB</span>
                    </p>
                    <button onclick='logout()' class="btn btn-clock mb-2" id="btnClock" style="background: #c53f3f;color: #fff;border: none;">
                        Keluar Akun
                    </button>
                `;
                rightCol.innerHTML = rightColHtml;


                row.appendChild(leftCol);
                row.appendChild(rightCol);
                cardAbsen.appendChild(row);
                bgPatternDiv.appendChild(cardAbsen);
                document.querySelector('#absenkeluar').appendChild(bgPatternDiv);
            };


            let updateClock = () => {
                let now = new Date();

                let options = {
                    timeZone: 'Asia/Jakarta',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                let timeString = now.toLocaleTimeString('id-ID', options);
                document.getElementById('currentTime').innerText = timeString;

                let dateOptions = {
                    weekday: 'long',
                    day: '2-digit',
                    month: 'long'
                };
                let dateString = now.toLocaleDateString('id-ID', dateOptions);
                document.getElementById('currentDate').innerText = dateString;
            };

            createDashboardUI();
            setInterval(updateClock, 100);
        };


        let renderHeader = () => {
            document.getElementById('headerx').innerHTML = `
                <div class="header" id="mainHeader">
                <div class="header-title">
                    <img src="./assets/images/logo/user/logo-utama.svg" alt="logo">
                </div>
                <div class="header-icons">
                    <i id="searchIcon" class="iconsax search-icon" data-icon="search-normal-2">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11.5 21.75C5.85 21.75 1.25 17.15 1.25 11.5C1.25 5.85 5.85 1.25 11.5 1.25C17.15 1.25 21.75 5.85 21.75 11.5C21.75 17.15 17.15 21.75 11.5 21.75ZM11.5 2.75C6.67 2.75 2.75 6.68 2.75 11.5C2.75 16.32 6.67 20.25 11.5 20.25C16.33 20.25 20.25 16.32 20.25 11.5C20.25 6.68 16.33 2.75 11.5 2.75Z" fill="#292D32"/>
                            <path d="M21.9995 22.7514C21.8095 22.7514 21.6195 22.6814 21.4695 22.5314L19.4695 20.5314C19.1795 20.2414 19.1795 19.7614 19.4695 19.4714C19.7595 19.1814 20.2395 19.1814 20.5295 19.4714L22.5295 21.4714C22.8195 21.7614 22.8195 22.2414 22.5295 22.5314C22.3795 22.6814 22.1895 22.7514 21.9995 22.7514Z" fill="#292D32"/>
                        </svg>
                    </i>
                    <i id="menuIcon" style='transform: rotate(90deg);' class="iconsax icon-btn" data-icon="menu-meatballs">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 14.75C3.48 14.75 2.25 13.52 2.25 12C2.25 10.48 3.48 9.25 5 9.25C6.52 9.25 7.75 10.48 7.75 12C7.75 13.52 6.52 14.75 5 14.75ZM5 10.75C4.31 10.75 3.75 11.31 3.75 12C3.75 12.69 4.31 13.25 5 13.25C5.69 13.25 6.25 12.69 6.25 12C6.25 11.31 5.69 10.75 5 10.75Z" fill="#292D32"/>
                            <path d="M19 14.75C17.48 14.75 16.25 13.52 16.25 12C16.25 10.48 17.48 9.25 19 9.25C20.52 9.25 21.75 10.48 21.75 12C21.75 13.52 20.52 14.75 19 14.75ZM19 10.75C18.31 10.75 17.75 11.31 17.75 12C17.75 12.69 18.31 13.25 19 13.25C19.69 13.25 20.25 12.69 20.25 12C20.25 11.31 19.69 10.75 19 10.75Z" fill="#292D32"/>
                            <path d="M12 14.75C10.48 14.75 9.25 13.52 9.25 12C9.25 10.48 10.48 9.25 12 9.25C13.52 9.25 14.75 10.48 14.75 12C14.75 13.52 13.52 14.75 12 14.75ZM12 10.75C11.31 10.75 10.75 11.31 10.75 12C10.75 12.69 11.31 13.25 12 13.25C12.69 13.25 13.25 12.69 13.25 12C13.25 11.31 12.69 10.75 12 10.75Z" fill="#292D32"/>
                        </svg>
                    </i>
                </div>
                <div class="dropdown-menu-custom" id="dropdownMenu">
                    <a href="#">History Input</a>
                    <a href="#">Schedule</a>
                    <a onclick='logout()'>Logout</a>
                </div>
                </div>
                <div class="search-bar" id="searchBar">
                    <i id="backIcon" class="iconsax icon-btn" data-icon="chevron-left">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.0013 20.6695C14.8113 20.6695 14.6213 20.5995 14.4713 20.4495L7.95125 13.9295C6.89125 12.8695 6.89125 11.1295 7.95125 10.0695L14.4713 3.54953C14.7613 3.25953 15.2413 3.25953 15.5312 3.54953C15.8212 3.83953 15.8212 4.31953 15.5312 4.60953L9.01125 11.1295C8.53125 11.6095 8.53125 12.3895 9.01125 12.8695L15.5312 19.3895C15.8212 19.6795 15.8212 20.1595 15.5312 20.4495C15.3813 20.5895 15.1912 20.6695 15.0013 20.6695Z" fill="#292D32"/>
                        </svg>
                    </i>
                    <div class="search-input-wrapper">
                        <i class="iconsax search-icon" data-icon="search-normal-2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11.5 21.75C5.85 21.75 1.25 17.15 1.25 11.5C1.25 5.85 5.85 1.25 11.5 1.25C17.15 1.25 21.75 5.85 21.75 11.5C21.75 17.15 17.15 21.75 11.5 21.75ZM11.5 2.75C6.67 2.75 2.75 6.68 2.75 11.5C2.75 16.32 6.67 20.25 11.5 20.25C16.33 20.25 20.25 16.32 20.25 11.5C20.25 6.68 16.33 2.75 11.5 2.75Z" fill="#292D32"/>
                                <path d="M21.9995 22.7514C21.8095 22.7514 21.6195 22.6814 21.4695 22.5314L19.4695 20.5314C19.1795 20.2414 19.1795 19.7614 19.4695 19.4714C19.7595 19.1814 20.2395 19.1814 20.5295 19.4714L22.5295 21.4714C22.8195 21.7614 22.8195 22.2414 22.5295 22.5314C22.3795 22.6814 22.1895 22.7514 21.9995 22.7514Z" fill="#292D32"/>
                            </svg>
                        </i>
                        <input type="text" placeholder="Search..." id="searchInput">
                        <img id="closeSearch" style='display:none;margin-right: 15px;' class="clear-btn" width="12" style="display: block; cursor: pointer; margin-right: 6px;" src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23c53f3f'%3e%3cpath d='M.293.293a1 1 0 0 1 1.414 0L8 6.586 14.293.293a1 1 0 1 1 1.414 1.414L9.414 8l6.293 6.293a1 1 0 0 1-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L6.586 8 .293 1.707a1 1 0 0 1 0-1.414z'/%3e%3c/svg%3e" alt="clear">
                    </div>
                </div>
            `;
            let searchIcon = document.getElementById('searchIcon');
            let menuIcon = document.getElementById('menuIcon');
            let searchBar = document.getElementById('searchBar');
            let mainHeader = document.getElementById('mainHeader');
            let backIcon = document.getElementById('backIcon');
            let closeSearch = document.getElementById('closeSearch');
            let searchInput = document.getElementById('searchInput');
            let dropdownMenu = document.getElementById('dropdownMenu');

            searchIcon.onclick = () => {
                mainHeader.style.display = 'none';
                searchBar.style.display = 'flex';
                searchInput.focus();
            };
            backIcon.onclick = () => {
                searchBar.style.display = 'none';
                mainHeader.style.display = 'flex';
                searchInput.value = '';
                closeSearch.style.display = 'none';
            };
            searchInput.oninput = () => {
                closeSearch.style.display = searchInput.value ? 'block' : 'none';
            };
            closeSearch.onclick = () => {
                searchInput.value = '';
                closeSearch.style.display = 'none';
                searchInput.focus();
            };
            menuIcon.onclick = () => {
                dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
            };
            document.onclick = e => {
                if (!menuIcon.contains(e.target) && !dropdownMenu.contains(e.target)) {
                    dropdownMenu.style.display = 'none';
                }
            };

            panelkeluar();
        };
        renderHeader();

        let waitUsercode = setInterval(() => {
            let el = document.getElementById("usercode");
            if (el) {
                clearInterval(waitUsercode);
                setTimeout(() => loadJadwal(el.value), 60);
            }
        }, 60);

        let loadJadwal = usercode => {
            let { minggu, hari } = getMingguHari();
            fetch(urlbe + "listjadwal", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ usercode, minggu, hari })
            })
                .then(r => r.json())
                .then(res => {
                    let list = document.querySelector(".my-ride-list");
                    let data = res.data || [];
                    let mapCust = {};
                    data.forEach(d => {
                        let key = d.cust_name || '-';
                        if (!mapCust[key] || new Date(d.created_at) > new Date(mapCust[key].created_at)) {
                            mapCust[key] = d;
                        }
                    });
                    let distinctData = Object.values(mapCust);
                    list.innerHTML = distinctData.map(d => {
                        let status = d.end_kunjungan ? "done" : "waiting";
                        let tanggal = d.created_at ? formatDateIndo(d.created_at.split('T')[0]) : '';
                        let start = formatTime(d.start_kunjungan);
                        let end = formatTime(d.end_kunjungan);
                        let jam = (start && end) ? `${start} - ${end}` : '';
                        let jamClass = jam ? '' : 'hide';
                        return `
                            <li>
                            <div class="my-ride-box">
                                <div class="my-ride-head">
                                <div class="my-ride-content flex-column" style="width:100%;margin:0 5px 0;">
                                    <div class="flex-spacing">
                                    <a href="#"><h6 class="title-color fw-medium">${d.cust_name || '-'}</h6></a>
                                    <span class="status accent-color fw-normal">${status}</span>
                                    </div>
                                </div>
                                </div>
                                <div class="my-ride-details">
                                    <div class="ride-info" style="flex-direction:unset;width:100%;margin:5px 5px 0;">
                                        ${d.Full_Name ? `
                                        <div class="ride-info-content">
                                            <div class="d-flex align-content-center gap-2 lh-base">
                                            <h5 class="fw-normal title-color">${d.Full_Name}</h5>
                                            </div>
                                            <h6 class="fw-normal content-color mt-1">${d.Job_Position || ''}</h6>
                                        </div>` : ''}
                                        <div class=" flex-align-center gap-2">
                                            <a href="edit-offer.html">
                                                <i class="iconsax icon" data-icon="edit-2">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M5.53999 19.5196C4.92999 19.5196 4.35999 19.3096 3.94999 18.9196C3.42999 18.4296 3.17999 17.6896 3.26999 16.8896L3.63999 13.6496C3.70999 13.0396 4.07999 12.2296 4.50999 11.7896L12.72 3.09956C14.77 0.929561 16.91 0.869561 19.08 2.91956C21.25 4.96956 21.31 7.10956 19.26 9.27956L11.05 17.9696C10.63 18.4196 9.84999 18.8396 9.23999 18.9396L6.01999 19.4896C5.84999 19.4996 5.69999 19.5196 5.53999 19.5196ZM15.93 2.90956C15.16 2.90956 14.49 3.38956 13.81 4.10956L5.59999 12.8096C5.39999 13.0196 5.16999 13.5196 5.12999 13.8096L4.75999 17.0496C4.71999 17.3796 4.79999 17.6496 4.97999 17.8196C5.15999 17.9896 5.42999 18.0496 5.75999 17.9996L8.97999 17.4496C9.26999 17.3996 9.74999 17.1396 9.94999 16.9296L18.16 8.23956C19.4 6.91956 19.85 5.69956 18.04 3.99956C17.24 3.22956 16.55 2.90956 15.93 2.90956Z" fill="#292D32"/>
                                                        <path d="M17.3404 10.9489C17.3204 10.9489 17.2904 10.9489 17.2704 10.9489C14.1504 10.6389 11.6404 8.26887 11.1604 5.16887C11.1004 4.75887 11.3804 4.37887 11.7904 4.30887C12.2004 4.24887 12.5804 4.52887 12.6504 4.93887C13.0304 7.35887 14.9904 9.21887 17.4304 9.45887C17.8404 9.49887 18.1404 9.86887 18.1004 10.2789C18.0504 10.6589 17.7204 10.9489 17.3404 10.9489Z" fill="#292D32"/>
                                                        <path d="M21 22.75H3C2.59 22.75 2.25 22.41 2.25 22C2.25 21.59 2.59 21.25 3 21.25H21C21.41 21.25 21.75 21.59 21.75 22C21.75 22.41 21.41 22.75 21 22.75Z" fill="#292D32"/>
                                                    </svg>
                                                </i>
                                            </a>
                                            <a href="#">
                                                <i class="iconsax icon error-icon" data-icon="trash">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M21 5.97998C17.67 5.64998 14.32 5.47998 10.98 5.47998C9 5.47998 7.02 5.57998 5.04 5.77998L3 5.97998" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                        <path d="M8.5 4.97L8.72 3.66C8.88 2.71 9 2 10.69 2H13.31C15 2 15.13 2.75 15.28 3.67L15.5 4.97" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                        <path d="M18.85 9.14001L18.2 19.21C18.09 20.78 18 22 15.21 22H8.79002C6.00002 22 5.91002 20.78 5.80002 19.21L5.15002 9.14001" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                        <path d="M10.33 16.5H13.66" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                        <path d="M9.5 12.5H14.5" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                    </svg>
                                                </i>
                                            </a>
                                        </div>
                                </div>
                                <ul class="ride-location-listing mt-3">
                                    <li class="location-box">
                                    <img class="icon" src="./assets/images/svg/location-fill.svg" alt="location">
                                    <h5 class="fw-light title-color">${d.Address || ''}</h5>
                                    </li>
                                    <li class="location-box ${(!tanggal && !jam) ? 'hide' : ''}">
                                    <img class="icon" src="./assets/images/svg/gps.svg" alt="gps">
                                    <div class="flex-spacing" style="width:100%;">
                                        <span class="fw-light title-color border-0">${tanggal}</span>
                                        <span class="fw-light title-color border-0 ml-auto ${jamClass}">${jam}</span>
                                    </div>
                                    </li>
                                </ul>
                                </div>
                            </div>
                            </li>
                        `;
                    }).join('');
                });
        };
    </script>
</body>

</html>